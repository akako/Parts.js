var Parts=new function(){var self=this,delegates={};this.secureOptions=!0,this.hashEncryptor={encrypt:function(t){return t},decrypt:function(t){return t}},this.setDelegate=function(t,e){void 0!==t&&0!=t.length&&(void 0!==e?delegates[t]=e:delete delegates[t])},this.get=function(t,e,n,o,s){if(s){var r=getHashObject();o=r.options[t]}onRequestStart(t,o),$.get(e,n,function(n){var s=(setHTMLToParts(t,resultToHTML(t,n,o)),getHashObject());s.urls[t]=e,s.options[t]=o,location.hash=s.toString(),onRequestFinished(t,o)})},this.post=function(t,e,n){onRequestStart(name,n),$.post(t,e,function(t){setHTMLToParts(name,resultToHTML(name,t,n));onRequestFinished(name,n)})},this.reload=function(t){var e=getHashObject();void 0!==e.urls[t]&&self.get(t,e.urls[t],void 0,void 0,!0)},this.reloadAll=function(){var t=getHashObject();for(var e in t.urls)self.get(e,t.urls[e],void 0,void 0,!0)},this.goToHash=function(t){var e=getHashObject();e.hash=t;var n=e.toString();location.hash=t,location.hash=n};var setHTMLToParts=function(t,e){var n=$("[parts-name="+t+"]");return n.html(e),n},getHashObject=function(){for(var t=self.hashEncryptor.decrypt(location.hash),e=t.split("#"),n="",o="",s=[],r="",i={},a={},l=0;l<e.length;l++)if(0===e[l].lastIndexOf("?",0))var h=e[l].substr(1).split("/"),n=h[0],o=void 0!==h[1]?h[1]:"";else e[l].length>0&&s.push(e[l]);s.length>0&&(r=s.join("#"),location.hash=r),location.hash=t;for(var u=n.split("&"),l=0;l<u.length;l++)if(0!=u[l].length){var c=u[l].split("="),d=c[0],f=decodeURIComponent(c[1]);void 0!==d&&0!=d.length&&void 0!==f&&0!=f.length&&(i[d]=f)}for(var g=o.split("&"),l=0;l<g.length;l++)if(0!=g[l].length){var v=g[l].split("="),d=v[0];try{var p=jsonDecode(decodeURIComponent(v[1]));if(void 0===d||0==d.length||void 0===p)continue;a[d]=p}catch(j){console.warn(j)}}return{hash:r,urls:i,options:a,toString:function(){var t=[],e=[];for(var n in i)t.push(n+"="+encodeURIComponent(i[n]));for(var n in a)e.push(n+"="+encodeURIComponent(jsonEncode(a[n])));var o="?"+t.join("&")+"/"+e.join("&")+(r.length>0?"#"+r:"");return self.hashEncryptor.encrypt(o)}}},jsonEncode=function(t){if(!self.secureOptions)for(var e in t)"function"==typeof t[e]&&(t[e]=t[e].toString());return JSON.stringify(t)},jsonDecode=function(jsonString){if(!self.secureOptions){var parser=function(k,v){return 0===v.toString().lastIndexOf("function",0)?eval("("+v+")"):v};return JSON.parse(jsonString,parser)}return JSON.parse(jsonString)},onRequestStart=function(t,e){var n=getDelegateMethod(t,"onRequestStart");void 0===n&&(n=getDelegateMethod("__default__","onRequestStart")),void 0!==n&&n(t,e)},resultToHTML=function(t,e,n){var o=getDelegateMethod(t,"resultToHTML");return void 0===o&&(o=getDelegateMethod("__default__","resultToHTML")),void 0!==o?o(t,e,n):e},onRequestFinished=function(t,e){var n=getDelegateMethod(t,"onRequestFinished");void 0===n&&(n=getDelegateMethod("__default__","onRequestFinished")),void 0!==n&&n(t,e)},getDelegateMethod=function(t,e){return"object"==typeof delegates[t]&&"function"==typeof delegates[t][e]?delegates[t][e]:void 0}};
